<div class="container-fluid bg-light min-vh-100 p-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex align-items-center mb-2">
        <button
          class="btn btn-link p-0 text-decoration-none me-3"
          (click)="goBack()"
        >
          <i class="fas fa-arrow-left"></i> Back to Applications
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="userDetails" class="row">
    <!-- User Information Card -->
    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-sm h-100 transition">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="fas fa-user me-2"></i>User Information</h5>
        </div>
        <div class="card-body">
          <div class="text-center mb-3">
            <i class="fas fa-user-circle fa-4x text-primary mb-2"></i>
            <h4 class="fw-bold">{{ userDetails.user.name }}</h4>
            <span class="badge bg-secondary">{{
              userDetails.user.role | titlecase
            }}</span>
          </div>

          <!-- Contact Info -->
          <div class="mb-3">
            <strong>Contact Information:</strong>
            <div class="mt-2">
              <p class="mb-1">
                <i class="fas fa-envelope me-2 text-muted"></i
                >{{ userDetails.user.email }}
              </p>
              <p class="mb-1">
                <i class="fas fa-phone me-2 text-muted"></i
                >{{ userDetails.user.phone }}
              </p>
              <p class="mb-1" *ngIf="userDetails.user.details.addressDetails">
                <i class="fas fa-map-marker-alt me-2 text-muted"></i>
                {{ userDetails.user.details.addressDetails.street }},
                {{ userDetails.user.details.addressDetails.city }},
                {{ userDetails.user.details.addressDetails.state }} -
                {{ userDetails.user.details.addressDetails.pinCode }}
              </p>
              <p class="mb-1" *ngIf="!userDetails.user.details.addressDetails">
                <i class="fas fa-map-marker-alt me-2 text-muted"></i>Not
                provided
              </p>
            </div>
          </div>

          <!-- Personal Details -->
          <div class="mb-3">
            <strong>Personal Details:</strong>
            <div class="mt-2">
              <p class="mb-1">
                <i class="fas fa-calendar me-2 text-muted"></i>DOB:
                {{ formatDate(userDetails.user.details.dob) }}
              </p>
              <p class="mb-1">
                <i class="fas fa-id-card me-2 text-muted"></i>Aadhar:
                {{ userDetails.user.details.aadharNumber }}
              </p>
            </div>
          </div>

          <!-- Employment -->
          <!-- Employment -->
          <div class="mb-3" *ngIf="userDetails.user.details.employment">
            <strong>Employment:</strong>
            <div class="mt-2">
              <p class="mb-1">
                <i class="fas fa-building me-2 text-muted"></i>
                Employer: {{ userDetails.user.details.employment.employer }}
              </p>
              <p class="mb-1">
                <i class="fas fa-briefcase me-2 text-muted"></i>
                Job Title: {{ userDetails.user.details.employment.jobTitle }}
              </p>
              <p class="mb-1">
                <i class="fas fa-chart-line me-2 text-muted"></i>
                Employment Type:
                {{ userDetails.user.details.employment.employmentType }}
              </p>
              <p class="mb-1">
                <i class="fas fa-rupee-sign me-2 text-muted"></i>
                Income: ₹{{
                  userDetails.user.details.employment.annualIncome / 12
                    | number : "1.0-0"
                }}/month
              </p>
              <p class="mb-1">
                <i class="fas fa-star me-2 text-muted"></i>
                Credit Score: {{ userDetails.user.details.creditScore }}
              </p>
            </div>
          </div>

          <!-- Education -->
          <div class="mb-3" *ngIf="userDetails.user.details.education">
            <strong>Education:</strong>
            <div class="mt-2">
              <p class="mb-1">
                <i class="fas fa-graduation-cap me-2 text-muted"></i>
                {{ userDetails.user.details.education.institution }} ({{
                  userDetails.user.details.education.degree
                }})
              </p>
            </div>
          </div>

          <!-- Member Since -->
          <div>
            <strong>Member Since:</strong>
            <p class="mb-0 text-muted">
              {{ formatDate(userDetails.user.details.dateJoined) }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="col-md-8">
      <!-- Row 1 -->
      <div class="row mb-4 g-3 row-cols-2 row-cols-md-2">
        <div class="col">
          <div class="card border-0 shadow-sm text-center h-100 transition">
            <div class="card-body">
              <i class="fas fa-money-bill-wave fa-2x text-success mb-2"></i>
              <h4 class="fw-bold text-success">
                ₹{{ userDetails.totalLoaned | number : "1.0-0" }}
              </h4>
              <small class="text-muted">Total Loaned</small>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card border-0 shadow-sm text-center h-100 transition">
            <div class="card-body">
              <i class="fas fa-hand-holding-usd fa-2x text-primary mb-2"></i>
              <h4 class="fw-bold text-primary">
                ₹{{ userDetails.totalRepaid | number : "1.0-0" }}
              </h4>
              <small class="text-muted">Total Repaid</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Row 2 -->
      <div class="row mb-4 g-3 row-cols-3">
        <div class="col">
          <div class="card border-0 shadow-sm text-center h-100 transition">
            <div class="card-body">
              <i class="fas fa-file-contract fa-2x text-warning mb-2"></i>
              <h4 class="fw-bold text-warning">
                {{ userDetails.activeLoans }}
              </h4>
              <small class="text-muted">Active Loans</small>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card border-0 shadow-sm text-center h-100 transition">
            <div class="card-body">
              <i class="fas fa-check-circle fa-2x text-info mb-2"></i>
              <h4 class="fw-bold text-info">
                {{ userDetails.completedLoans }}
              </h4>
              <small class="text-muted">Completed</small>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card border-0 shadow-sm text-center h-100 transition">
            <div class="card-body">
              <i class="fas fa-times-circle fa-2x text-danger mb-2"></i>
              <h4 class="fw-bold text-danger">
                {{ userDetails.rejectedLoans }}
              </h4>
              <small class="text-muted">Rejected</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Loan History -->
      <div class="card border-0 shadow-sm mb-4 transition">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-history me-2"></i>Loan History</h5>
        </div>
        <div class="card-body">
          <div *ngIf="!userDetails?.loans?.length">
            <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
            <p class="text-muted">No loans found</p>
          </div>
          <div *ngFor="let loan of userDetails?.loans">
            <div class="row border rounded p-3 mb-3 loan-card">
              <div class="col-md-8">
                <h6 class="fw-bold mb-2">{{ loan.purpose }}</h6>
                <p class="mb-1">
                  <strong>Amount:</strong> ₹{{ loan.amount | number : "1.0-0" }}
                </p>
                <p class="mb-1">
                  <strong>Duration:</strong> {{ loan.duration }} months
                </p>
                <p class="mb-1"><strong>Loan ID:</strong> {{ loan.id }}</p>
                <p class="mb-0" *ngIf="loan.outstandingBalance">
                  <strong>Outstanding:</strong> ₹{{
                    loan.outstandingBalance | number : "1.0-0"
                  }}
                </p>
              </div>
              <div class="col-md-4 text-end">
                <span
                  class="badge rounded-pill px-3 py-2"
                  [ngClass]="getLoanStatusClass(loan.status)"
                >
                  {{ loan.status }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Repayment History -->
      <div class="card border-0 shadow-sm transition">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="fas fa-receipt me-2"></i>Repayment History
          </h5>
        </div>
        <div class="card-body">
          <div *ngIf="!userDetails?.repayments?.length">
            <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
            <p class="text-muted">No repayments found</p>
          </div>
          <div class="table-responsive" *ngIf="userDetails?.repayments?.length">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Date</th>
                  <th>Loan ID</th>
                  <th>Amount</th>
                  <th>Payment ID</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  *ngFor="let repayment of userDetails.repayments"
                  class="repayment-row"
                >
                  <td>{{ formatDate(repayment.date) }}</td>
                  <td>{{ repayment.loanId }}</td>
                  <td class="fw-bold text-success">
                    ₹{{ repayment.amount | number : "1.0-0" }}
                  </td>
                  <td>{{ repayment.id }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="!userDetails && !error" class="text-center py-5">
    <div class="spinner-border text-primary spinner-border-lg" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted mt-2">Loading user details...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger rounded-3 border-0">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
  </div>
</div>
